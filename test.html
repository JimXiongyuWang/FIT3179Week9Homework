<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deaths Attributed to Unsafe Water Source</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.8"></script>
</head>

<body>

    <select id="yearSelector">
        <!-- You can expand the range based on your data -->
        <option value="1990">1990</option>
        <option value="1991">1991</option>
        <!-- ... -->
        <option value="2019" selected>2019</option>
    </select>

    <div id="vis"></div>

    <script>
        const yearSelector = document.getElementById("yearSelector");

        function renderMap(year) {
            const spec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "Deaths Attributed to Unsafe Water Source (" + year + ")",
                "width": 800,
                "height": 500,
                "projection": {
                    "type": "equalEarth"
                },
                "layer": [
                    {
                        "data": {
                            "url": "https://raw.githubusercontent.com/JimXiongyuWang/FIT3179Week9Homework/main/js/ne_110m.json",
                            "format": {
                                "type": "topojson",
                                "feature": "ne_110m_graticules_30"
                            }
                        },
                        "mark": {
                            "type": "geoshape",
                            "fill": null,
                            "stroke": "lightgray"
                        }
                    },
                    {
                        "data": {
                            "url": "https://raw.githubusercontent.com/JimXiongyuWang/FIT3179Week9Homework/main/js/ne_110m.json",
                            "format": {
                                "type": "topojson",
                                "feature": "ne_110m_admin_0_countries"
                            }
                        },
                        "transform": [{
                            "lookup": "properties.NAME",
                            "from": {
                                "data": {
                                    "url": "https://raw.githubusercontent.com/JimXiongyuWang/FIT3179Week9Homework/main/data/share-deaths-unsafe-water.csv"
                                },
                                "key": "Entity",
                                "fields": ["attributed"]
                            }
                        },
                        {
                            "filter": `datum.Year == ${year} && datum.attributed != null`
                        }],
                        "mark": {
                            "type": "geoshape"
                        },
                        "encoding": {
                            "color": {
                                "field": "attributed",
                                "type": "quantitative",
                                "legend": {
                                    "title": "Deaths due to Unsafe Water"
                                },
                                "scale": {
                                    "scheme": "reds"
                                }
                            },
                            "tooltip": [{
                                    "field": "properties.NAME",
                                    "type": "nominal",
                                    "title": "Country"
                                },
                                {
                                    "field": "attributed",
                                    "type": "quantitative",
                                    "title": "Share of total deaths that are from all causes attributed to unsafe water source",
                                    "format": ".2f"
                                }
                            ]
                        }
                    }
                ]
            };

            vegaEmbed('#vis', spec, {
                mode: "vega-lite"
            }).then(res => console.log(res)).catch(err => console.error(err));
        }

        // Initial render
        renderMap(yearSelector.value);

        yearSelector.addEventListener("change", (event) => {
            renderMap(event.target.value);
        });
    </script>

</body>

</html>
